# Claude サブエージェント ドキュメント

## 概要

サブエージェントは、特定のタスクタイプに特化したAIアシスタントです。独立したコンテキストウィンドウを持ち、カスタムツールやシステムプロンプトで構成できます。

## 主な特徴

- **単一の明確な責任** - 各サブエージェントは特定のタスクに集中
- **独立したコンテキスト** - メインコンテキストとは別の専用コンテキストで動作
- **ツールアクセス制御** - 制限または継承されたツールアクセスが可能

## サブエージェントの種類

1. **プロジェクトレベル サブエージェント**
   - 保存場所: `.claude/agents/`
   - プロジェクト固有のタスクに使用

2. **ユーザーレベル サブエージェント**
   - 保存場所: `~/.claude/agents/`
   - すべてのプロジェクトで使用可能

## 実装方法

### ファイル構造

サブエージェントはMarkdownファイルとして定義され、YAMLフロントマターを含みます：

```yaml
---
name: agent-name
description: Brief description of what this agent does
tools: [Read, Edit, Bash, Grep, Glob]  # オプション
---

# エージェント名

詳細なプロンプトとインストラクションをここに記述...
```

### 必須フィールド

- `name`: エージェントの識別子
- `description`: エージェントの簡潔な説明

### オプションフィールド

- `tools`: 使用可能なツールのリスト（指定しない場合はすべてのツールを継承）

## サンプル サブエージェント

### 1. コードレビュアー

```yaml
---
name: code-reviewer
description: Specialized code review expert
tools: [Read, Grep, Glob, Bash]
---

# Code Reviewer

あなたは経験豊富なコードレビュアーです。以下の観点でコードを分析してください：

- コード品質とベストプラクティス
- セキュリティの脆弱性
- パフォーマンスの問題
- 保守性と可読性
- テストカバレッジ
```

### 2. デバッガー

```yaml
---
name: debugger
description: Error and unexpected behavior debugging specialist
tools: [Read, Edit, Bash, Grep, Glob]
---

# Debugger

エラーとバグの特定・修正のスペシャリストとして：

1. エラーメッセージとスタックトレースを分析
2. 根本原因を特定
3. 修正案を提案
4. 実装とテスト
```

### 3. データサイエンティスト

```yaml
---
name: data-scientist
description: SQL and BigQuery analysis specialist
tools: [Bash, Read, Write]
---

# Data Scientist

効率的なSQLクエリの作成と最適化を専門とします：

- 複雑なデータ分析クエリの作成
- パフォーマンス最適化
- データの可視化と洞察の提供
```

## 呼び出し方法

### 1. 自動委任

Claudeは、タスクの説明に基づいて適切なサブエージェントを自動的に選択します：

```
ユーザー: "このコードをレビューしてください"
→ code-reviewerが自動的に呼び出される
```

### 2. 明示的な呼び出し

サブエージェント名を明示的に指定：

```
ユーザー: "code-reviewerを使ってこのPRをチェックして"
```

## ベストプラクティス

### 1. Claude生成エージェントから始める

```bash
# 新しいサブエージェントを作成
claude code "新しいデバッグ用サブエージェントを作成して"
```

### 2. 詳細なプロンプトを書く

- アクション指向の具体的な指示
- 明確な成功基準
- 期待される出力形式

### 3. ツールアクセスを制限

必要最小限のツールのみを許可：

```yaml
tools: [Read, Grep]  # 読み取り専用のエージェント
```

### 4. バージョン管理

プロジェクトサブエージェントはGitで管理：

```bash
git add .claude/agents/
git commit -m "Add custom code reviewer agent"
```

## 高度な使用方法

### サブエージェントの連鎖

複数のサブエージェントを順番に使用：

```
1. debugger → 問題を特定
2. code-reviewer → 修正案をレビュー
3. test-writer → テストを追加
```

### 動的選択

コンテキストに基づいてサブエージェントを動的に選択：

```
if (言語 == "Python"):
    python-expert を使用
else if (言語 == "JavaScript"):
    js-expert を使用
```

## パフォーマンスの考慮事項

### 利点

- **メインコンテキストの保護** - 不要な情報でメインコンテキストを汚染しない
- **専門性の向上** - 特定のタスクに最適化された応答
- **並列処理** - 複数のサブエージェントを同時に実行可能

### 注意点

- **レイテンシの増加** - コンテキスト収集に追加時間が必要
- **コンテキスト制限** - 各サブエージェントには独自のコンテキスト制限がある

## トラブルシューティング

### よくある問題

1. **サブエージェントが見つからない**
   - ファイルパスを確認
   - YAMLフロントマターの形式を確認

2. **ツールアクセスエラー**
   - tools配列に正しいツール名を指定
   - ツール名の大文字小文字を確認

3. **予期しない動作**
   - プロンプトの明確性を確認
   - ツールの制限が適切か確認

## まとめ

サブエージェントは、Claude Codeの機能を拡張し、特定のタスクに特化したアシスタントを作成するための強力な機能です。適切に設計されたサブエージェントは、開発ワークフローを大幅に改善し、より効率的で正確な結果を提供します。