name: Create Radio Audio with Music

on:
  workflow_dispatch:
    inputs:
      script_content:
        description: 'ãƒ©ã‚¸ã‚ªã®åŸç¨¿ï¼ˆãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ï¼‰'
        required: true
        type: string
      music_mood:
        description: 'éŸ³æ¥½ã®é›°å›²æ°—ï¼ˆä¾‹ï¼šãƒªãƒ©ãƒƒã‚¯ã‚¹ã€ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ã€ã‚¸ãƒ£ã‚ºé¢¨ï¼‰'
        required: true
        type: string

jobs:
  setup-branch:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    outputs:
      branch-name: ${{ steps.create-branch.outputs.branch-name }}
      folder-name: ${{ steps.create-branch.outputs.folder-name }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Create branch for radio audio generation
        id: create-branch
        run: |
          BRANCH_NAME="radio-audio/$(date +%Y%m%d)-${{ github.run_id }}"
          FOLDER_NAME="radio-audio-$(date +%Y%m%d)-${{ github.run_id }}"
          git checkout -b $BRANCH_NAME
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git push origin $BRANCH_NAME
          echo "branch-name=$BRANCH_NAME" >> $GITHUB_OUTPUT
          echo "folder-name=$FOLDER_NAME" >> $GITHUB_OUTPUT
          echo "Created branch: $BRANCH_NAME"
          echo "Folder name: $FOLDER_NAME"

  script-planning:
    runs-on: ubuntu-latest
    needs: [setup-branch]
    permissions:
      contents: write
    outputs:
      planning-completed: ${{ steps.planning.outputs.completed }}
      # Version A outputs
      radio-script-a: ${{ steps.planning.outputs.radio-script-a }}
      voice-style-a: ${{ steps.planning.outputs.voice-style-a }}
      music-prompt-a: ${{ steps.planning.outputs.music-prompt-a }}
      # Version B outputs
      radio-script-b: ${{ steps.planning.outputs.radio-script-b }}
      voice-style-b: ${{ steps.planning.outputs.voice-style-b }}
      music-prompt-b: ${{ steps.planning.outputs.music-prompt-b }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.setup-branch.outputs.branch-name }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Claude Code SDK
        run: npm install @anthropic-ai/claude-code
      
      - name: ãƒ©ã‚¸ã‚ªå°æœ¬ä½œæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
        id: planning
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "::group::ğŸ™ï¸ Radio Script Planning Agent Execution"
          echo "Starting at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
          
          # è¨­å®š
          SCRIPT_CONTENT="${{ inputs.script_content }}"
          MUSIC_MOOD="${{ inputs.music_mood }}"
          FOLDER_NAME="${{ needs.setup-branch.outputs.folder-name }}"
          PLANNING_DIR="$FOLDER_NAME/planning"
          
          echo "Script content: $SCRIPT_CONTENT"
          echo "Music mood: $MUSIC_MOOD"
          echo "Planning folder: $PLANNING_DIR"
          
          # è¨ˆç”»ãƒ•ã‚©ãƒ«ãƒ€ã‚’äº‹å‰ã«ä½œæˆï¼ˆA/Bç‰ˆä¸¡æ–¹ï¼‰
          PLANNING_DIR_A="$PLANNING_DIR/version-a"
          PLANNING_DIR_B="$PLANNING_DIR/version-b"
          
          if [ ! -d "$PLANNING_DIR_A" ]; then
            mkdir -p "$PLANNING_DIR_A"
            echo "ğŸ“ Created planning folder A: $PLANNING_DIR_A"
          fi
          
          if [ ! -d "$PLANNING_DIR_B" ]; then
            mkdir -p "$PLANNING_DIR_B"
            echo "ğŸ“ Created planning folder B: $PLANNING_DIR_B"
          fi
          
          # Version Aç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹ç¯‰
          PROMPT_A="ã‚ãªãŸã¯ãƒ©ã‚¸ã‚ªç•ªçµ„åˆ¶ä½œã®å°‚é–€å®¶ã§ã™ã€‚åŸç¨¿ã‹ã‚‰1åˆ†ç¨‹åº¦ã®ãƒ©ã‚¸ã‚ªå°æœ¬ã‚’ä½œæˆã—ã€éŸ³æ¥½ã¨åˆæˆã™ã‚‹ãŸã‚ã®æˆ¦ç•¥ã‚’ç«‹ã¦ã¦ãã ã•ã„ã€‚

          **åŸç¨¿å†…å®¹**: $SCRIPT_CONTENT
          **éŸ³æ¥½ã®é›°å›²æ°—**: $MUSIC_MOOD
          **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Aï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ»è¦ªã—ã¿ã‚„ã™ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰

          **ã‚¿ã‚¹ã‚¯**:
          1. åŸç¨¿ã‚’åˆ†æã—ã€1åˆ†ç¨‹åº¦ï¼ˆç´„150-200æ–‡å­—ï¼‰ã®ãƒ©ã‚¸ã‚ªå°æœ¬ã«ã¾ã¨ã‚ã‚‹
          2. ã‚«ãƒ ã‚¤æ—¥å ±ã®è©±è€…ã®å£èª¿ãƒ»ç‰¹å¾´ã‚’åæ˜ ã—ãŸå°æœ¬ã«èª¿æ•´ï¼ˆã‚ˆã‚Šè¦ªã—ã¿ã‚„ã™ãã€å£ç™–ã‚’å¤šç”¨ï¼‰
          3. éŸ³æ¥½ã®é›°å›²æ°—ã«åˆã‚ã›ãŸè©±ã—æ–¹ãƒ»ãƒˆãƒ¼ãƒ³ã‚’è¨­å®šï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«å¯„ã‚Šï¼‰
          4. aivis-apiç”¨ã®éŸ³å£°ç”Ÿæˆè¨­å®šã‚’è¨ˆç”»ï¼ˆè©±é€Ÿ1.0ã€æ„Ÿæƒ…å¼·åº¦æ¨™æº–ï¼‰
          5. éŸ³æ¥½ç”Ÿæˆç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆï¼ˆãƒªãƒ©ãƒƒã‚¯ã‚¹ãƒ»è¦ªã—ã¿ã‚„ã™ã„é›°å›²æ°—ï¼‰
          6. éŸ³å£°ã¨éŸ³æ¥½ã®åˆæˆæˆ¦ç•¥ã‚’ç­–å®š
          7. ãƒ©ã‚¸ã‚ªå°æœ¬ã‚’ã€Œ$PLANNING_DIR_A/radio-script.txtã€ã«ä¿å­˜
          8. éŸ³å£°ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šã‚’ã€Œ$PLANNING_DIR_A/voice-style.jsonã€ã«ä¿å­˜
          9. éŸ³æ¥½ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã€Œ$PLANNING_DIR_A/music-prompt.txtã€ã«ä¿å­˜
          10. åˆ¶ä½œæˆ¦ç•¥æ›¸ã‚’ã€Œ$PLANNING_DIR_A/radio-strategy.mdã€ã«ä¿å­˜

          **ã‚«ãƒ ã‚¤æ—¥å ±è©±è€…ã®ç‰¹å¾´**ï¼ˆvoice_analysis.txtã‹ã‚‰ï¼‰:
          - ã€Œãˆã£ã¨ã€ã€Œã§ã™ã­ã€ã€Œã¡ã‚‡ã£ã¨ã€ã‚’å¤šç”¨
          - ã€Œã€œã¿ãŸã„ãªæ„Ÿã˜ã€ã€Œã€œã£ã¦ã„ã†æ„Ÿã˜ã€ã§èª¬æ˜
          - æŠ€è¡“çš„ãªå†…å®¹ã‚’è¦ªã—ã¿ã‚„ã™ãè§£èª¬
          - ã€Œã™ã”ã„ã€ã€Œã‚„ã°ã„ã€ãªã©ã®æ„Ÿå˜†è©ã‚’ä½¿ç”¨
          - ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã ãŒä¸å¯§ãªèªèª¿

          **éŸ³å£°ç”Ÿæˆè¨­å®šä¾‹**:
          - model_uuid: a59cb814-0083-4369-8542-f51a29e72af7
          - speaking_rate: 1.0ï¼ˆè¦ªã—ã¿ã‚„ã™ã„ãƒšãƒ¼ã‚¹ï¼‰
          - emotional_intensity: 0.5ï¼ˆæ¨™æº–çš„ãªæ„Ÿæƒ…è¡¨ç¾ï¼‰
          - output_format: wavï¼ˆé«˜éŸ³è³ªåˆæˆç”¨ï¼‰

          ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€æˆ¦ç•¥ã‚’è¨ˆç”»ã—ã¦ãã ã•ã„ã€‚"

          # Version Bç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹ç¯‰
          PROMPT_B="ã‚ãªãŸã¯ãƒ©ã‚¸ã‚ªç•ªçµ„åˆ¶ä½œã®å°‚é–€å®¶ã§ã™ã€‚åŸç¨¿ã‹ã‚‰1åˆ†ç¨‹åº¦ã®ãƒ©ã‚¸ã‚ªå°æœ¬ã‚’ä½œæˆã—ã€éŸ³æ¥½ã¨åˆæˆã™ã‚‹ãŸã‚ã®æˆ¦ç•¥ã‚’ç«‹ã¦ã¦ãã ã•ã„ã€‚

          **åŸç¨¿å†…å®¹**: $SCRIPT_CONTENT
          **éŸ³æ¥½ã®é›°å›²æ°—**: $MUSIC_MOOD
          **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Bï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ»èª¬æ˜é‡è¦–ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰

          **ã‚¿ã‚¹ã‚¯**:
          1. åŸç¨¿ã‚’åˆ†æã—ã€1åˆ†ç¨‹åº¦ï¼ˆç´„150-200æ–‡å­—ï¼‰ã®ãƒ©ã‚¸ã‚ªå°æœ¬ã«ã¾ã¨ã‚ã‚‹
          2. ã‚«ãƒ ã‚¤æ—¥å ±ã®è©±è€…ã®å£èª¿ãƒ»ç‰¹å¾´ã‚’åæ˜ ã—ãŸå°æœ¬ã«èª¿æ•´ï¼ˆã‚ˆã‚Šèª¬æ˜çš„ã€æŠ€è¡“çš„ãªè¡¨ç¾é‡è¦–ï¼‰
          3. éŸ³æ¥½ã®é›°å›²æ°—ã«åˆã‚ã›ãŸè©±ã—æ–¹ãƒ»ãƒˆãƒ¼ãƒ³ã‚’è¨­å®šï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å¯„ã‚Šï¼‰
          4. aivis-apiç”¨ã®éŸ³å£°ç”Ÿæˆè¨­å®šã‚’è¨ˆç”»ï¼ˆè©±é€Ÿ1.2ã€æ„Ÿæƒ…å¼·åº¦æ§ãˆã‚ï¼‰
          5. éŸ³æ¥½ç”Ÿæˆç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆï¼ˆé›†ä¸­ãƒ»ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªé›°å›²æ°—ï¼‰
          6. éŸ³å£°ã¨éŸ³æ¥½ã®åˆæˆæˆ¦ç•¥ã‚’ç­–å®š
          7. ãƒ©ã‚¸ã‚ªå°æœ¬ã‚’ã€Œ$PLANNING_DIR_B/radio-script.txtã€ã«ä¿å­˜
          8. éŸ³å£°ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šã‚’ã€Œ$PLANNING_DIR_B/voice-style.jsonã€ã«ä¿å­˜
          9. éŸ³æ¥½ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã€Œ$PLANNING_DIR_B/music-prompt.txtã€ã«ä¿å­˜
          10. åˆ¶ä½œæˆ¦ç•¥æ›¸ã‚’ã€Œ$PLANNING_DIR_B/radio-strategy.mdã€ã«ä¿å­˜

          **ã‚«ãƒ ã‚¤æ—¥å ±è©±è€…ã®ç‰¹å¾´**ï¼ˆvoice_analysis.txtã‹ã‚‰ï¼‰:
          - æŠ€è¡“çš„ãªå†…å®¹ã®è©³ç´°ãªèª¬æ˜ã‚’é‡è¦–
          - å°‚é–€ç”¨èªã®å¾Œã«åˆ†ã‹ã‚Šã‚„ã™ã„èª¬æ˜ã‚’è¿½åŠ 
          - å®Ÿè£…ã®å„ªå…ˆé †ä½ã‚’æ˜ç¢ºã«èª¬æ˜
          - æ¯”è¼ƒè¡¨ç¾å¤šç”¨ï¼ˆã€Œã€œã‚ˆã‚Šã€œã®æ–¹ãŒã€ï¼‰
          - åŠ¹ç‡æ€§ãƒ»æ­£ç¢ºæ€§ã‚’é‡è¦–ã—ãŸè¡¨ç¾

          **éŸ³å£°ç”Ÿæˆè¨­å®šä¾‹**:
          - model_uuid: a59cb814-0083-4369-8542-f51a29e72af7
          - speaking_rate: 1.2ï¼ˆå°‘ã—é€Ÿã‚ã®ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒšãƒ¼ã‚¹ï¼‰
          - emotional_intensity: 0.3ï¼ˆæ§ãˆã‚ãªæ„Ÿæƒ…è¡¨ç¾ï¼‰
          - output_format: wavï¼ˆé«˜éŸ³è³ªåˆæˆç”¨ï¼‰

          ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€æˆ¦ç•¥ã‚’è¨ˆç”»ã—ã¦ãã ã•ã„ã€‚"

          # Version A Claude Codeå®Ÿè¡Œ
          echo "ğŸ™ï¸ Generating Version A (Casual/Friendly)"
          npx claude-code --prompt "$PROMPT_A"
          
          # Version B Claude Codeå®Ÿè¡Œ
          echo "ğŸ™ï¸ Generating Version B (Professional/Technical)"
          npx claude-code --prompt "$PROMPT_B"
          
          # Version Aå‡ºåŠ›ã®ç¢ºèª
          echo "ğŸ” Checking Version A outputs..."
          if [ -f "$PLANNING_DIR_A/radio-script.txt" ]; then
            echo "âœ… Radio script A created"
            RADIO_SCRIPT_A=$(cat "$PLANNING_DIR_A/radio-script.txt")
            echo "radio-script-a<<EOF" >> $GITHUB_OUTPUT
            echo "$RADIO_SCRIPT_A" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          else
            echo "âŒ Radio script A not found"
            exit 1
          fi

          if [ -f "$PLANNING_DIR_A/voice-style.json" ]; then
            echo "âœ… Voice style A settings created"
            VOICE_STYLE_A=$(cat "$PLANNING_DIR_A/voice-style.json")
            echo "voice-style-a<<EOF" >> $GITHUB_OUTPUT
            echo "$VOICE_STYLE_A" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          else
            echo "âŒ Voice style A not found"
            exit 1
          fi

          if [ -f "$PLANNING_DIR_A/music-prompt.txt" ]; then
            echo "âœ… Music prompt A created"
            MUSIC_PROMPT_A=$(cat "$PLANNING_DIR_A/music-prompt.txt")
            echo "music-prompt-a<<EOF" >> $GITHUB_OUTPUT
            echo "$MUSIC_PROMPT_A" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          else
            echo "âŒ Music prompt A not found"
            exit 1
          fi

          # Version Bå‡ºåŠ›ã®ç¢ºèª
          echo "ğŸ” Checking Version B outputs..."
          if [ -f "$PLANNING_DIR_B/radio-script.txt" ]; then
            echo "âœ… Radio script B created"
            RADIO_SCRIPT_B=$(cat "$PLANNING_DIR_B/radio-script.txt")
            echo "radio-script-b<<EOF" >> $GITHUB_OUTPUT
            echo "$RADIO_SCRIPT_B" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          else
            echo "âŒ Radio script B not found"
            exit 1
          fi

          if [ -f "$PLANNING_DIR_B/voice-style.json" ]; then
            echo "âœ… Voice style B settings created"
            VOICE_STYLE_B=$(cat "$PLANNING_DIR_B/voice-style.json")
            echo "voice-style-b<<EOF" >> $GITHUB_OUTPUT
            echo "$VOICE_STYLE_B" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          else
            echo "âŒ Voice style B not found"
            exit 1
          fi

          if [ -f "$PLANNING_DIR_B/music-prompt.txt" ]; then
            echo "âœ… Music prompt B created"
            MUSIC_PROMPT_B=$(cat "$PLANNING_DIR_B/music-prompt.txt")
            echo "music-prompt-b<<EOF" >> $GITHUB_OUTPUT
            echo "$MUSIC_PROMPT_B" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          else
            echo "âŒ Music prompt B not found"
            exit 1
          fi

          echo "completed=true" >> $GITHUB_OUTPUT
          echo "::endgroup::"

  generate-audio-and-music:
    runs-on: ubuntu-latest
    needs: [setup-branch, script-planning]
    permissions:
      contents: write
    outputs:
      # Version A outputs
      voice-url-a: ${{ steps.voice-generation-a.outputs.voice-url }}
      music-url-a: ${{ steps.music-generation-a.outputs.music-url }}
      # Version B outputs
      voice-url-b: ${{ steps.voice-generation-b.outputs.voice-url }}
      music-url-b: ${{ steps.music-generation-b.outputs.music-url }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.setup-branch.outputs.branch-name }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Claude Code SDK
        run: npm install @anthropic-ai/claude-code
      
      # éŸ³å£°ç”ŸæˆAï¼ˆaivis-apiä½¿ç”¨ï¼‰
      - name: éŸ³å£°ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆA
        id: voice-generation-a
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          AIVIS_API_KEY: ${{ secrets.AIVIS_API_KEY }}
        run: |
          echo "::group::ğŸ¤ Voice Generation Agent A Execution"
          
          FOLDER_NAME="${{ needs.setup-branch.outputs.folder-name }}"
          AUDIO_DIR_A="$FOLDER_NAME/audio/version-a"
          
          # éŸ³å£°ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
          mkdir -p "$AUDIO_DIR_A"
          
          RADIO_SCRIPT_A="${{ needs.script-planning.outputs.radio-script-a }}"
          VOICE_STYLE_A="${{ needs.script-planning.outputs.voice-style-a }}"
          
          PROMPT="aivis-apiã‚’ä½¿ç”¨ã—ã¦ãƒ©ã‚¸ã‚ªéŸ³å£°ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³Aï¼šã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

          **å°æœ¬**: $RADIO_SCRIPT_A
          **éŸ³å£°è¨­å®š**: $VOICE_STYLE_A
          **API Key**: ç’°å¢ƒå¤‰æ•°AIVIS_API_KEYã‹ã‚‰å–å¾—
          **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Aï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ»è¦ªã—ã¿ã‚„ã™ã„ï¼‰

          **ã‚¿ã‚¹ã‚¯**:
          1. aivis-apiï¼ˆhttps://api.aivis-project.com/v1/tts/synthesizeï¼‰ã‚’ä½¿ã£ã¦éŸ³å£°ç”Ÿæˆ
          2. é«˜éŸ³è³ªWAVå½¢å¼ã§å‡ºåŠ›
          3. ç”Ÿæˆã—ãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Œ$AUDIO_DIR_A/radio-voice.wavã€ã«ä¿å­˜
          4. éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’å‡ºåŠ›

          aivis-apiã®ä½¿ç”¨æ–¹æ³•:
          - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: POST https://api.aivis-project.com/v1/tts/synthesize
          - Authorization: Bearer \$AIVIS_API_KEY
          - model_uuid: a59cb814-0083-4369-8542-f51a29e72af7
          - output_format: wav
          - å°æœ¬ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šã‚’ä½¿ç”¨

          éŸ³å£°ã‚’ç”Ÿæˆã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚"

          npx claude-code --prompt "$PROMPT"
          
          # éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
          if [ -f "$AUDIO_DIR_A/radio-voice.wav" ]; then
            echo "âœ… Voice A generated successfully"
            echo "voice-url=$AUDIO_DIR_A/radio-voice.wav" >> $GITHUB_OUTPUT
          else
            echo "âŒ Voice A generation failed"
            exit 1
          fi
          
          echo "::endgroup::"

      # éŸ³å£°ç”ŸæˆBï¼ˆaivis-apiä½¿ç”¨ï¼‰
      - name: éŸ³å£°ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆB
        id: voice-generation-b
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          AIVIS_API_KEY: ${{ secrets.AIVIS_API_KEY }}
        run: |
          echo "::group::ğŸ¤ Voice Generation Agent B Execution"
          
          FOLDER_NAME="${{ needs.setup-branch.outputs.folder-name }}"
          AUDIO_DIR_B="$FOLDER_NAME/audio/version-b"
          
          # éŸ³å£°ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
          mkdir -p "$AUDIO_DIR_B"
          
          RADIO_SCRIPT_B="${{ needs.script-planning.outputs.radio-script-b }}"
          VOICE_STYLE_B="${{ needs.script-planning.outputs.voice-style-b }}"
          
          PROMPT="aivis-apiã‚’ä½¿ç”¨ã—ã¦ãƒ©ã‚¸ã‚ªéŸ³å£°ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³Bï¼šãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

          **å°æœ¬**: $RADIO_SCRIPT_B
          **éŸ³å£°è¨­å®š**: $VOICE_STYLE_B
          **API Key**: ç’°å¢ƒå¤‰æ•°AIVIS_API_KEYã‹ã‚‰å–å¾—
          **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Bï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ»æŠ€è¡“çš„ï¼‰

          **ã‚¿ã‚¹ã‚¯**:
          1. aivis-apiï¼ˆhttps://api.aivis-project.com/v1/tts/synthesizeï¼‰ã‚’ä½¿ã£ã¦éŸ³å£°ç”Ÿæˆ
          2. é«˜éŸ³è³ªWAVå½¢å¼ã§å‡ºåŠ›
          3. ç”Ÿæˆã—ãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Œ$AUDIO_DIR_B/radio-voice.wavã€ã«ä¿å­˜
          4. éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’å‡ºåŠ›

          aivis-apiã®ä½¿ç”¨æ–¹æ³•:
          - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: POST https://api.aivis-project.com/v1/tts/synthesize
          - Authorization: Bearer \$AIVIS_API_KEY
          - model_uuid: a59cb814-0083-4369-8542-f51a29e72af7
          - output_format: wav
          - å°æœ¬ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šã‚’ä½¿ç”¨

          éŸ³å£°ã‚’ç”Ÿæˆã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚"

          npx claude-code --prompt "$PROMPT"
          
          # éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
          if [ -f "$AUDIO_DIR_B/radio-voice.wav" ]; then
            echo "âœ… Voice B generated successfully"
            echo "voice-url=$AUDIO_DIR_B/radio-voice.wav" >> $GITHUB_OUTPUT
          else
            echo "âŒ Voice B generation failed"
            exit 1
          fi
          
          echo "::endgroup::"

      # éŸ³æ¥½ç”ŸæˆAï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
      - name: éŸ³æ¥½ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆA
        id: music-generation-a
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "::group::ğŸµ Music Generation Agent A Execution"
          
          FOLDER_NAME="${{ needs.setup-branch.outputs.folder-name }}"
          MUSIC_DIR_A="$FOLDER_NAME/music/version-a"
          
          # éŸ³æ¥½ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
          mkdir -p "$MUSIC_DIR_A"
          
          MUSIC_PROMPT_A="${{ needs.script-planning.outputs.music-prompt-a }}"
          
          PROMPT="kamuicode MCPã‚’ä½¿ç”¨ã—ã¦èƒŒæ™¯éŸ³æ¥½ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³Aï¼šã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

          **éŸ³æ¥½ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: $MUSIC_PROMPT_A
          **å‡ºåŠ›é•·ã•**: ç´„60-90ç§’ï¼ˆéŸ³å£°ã®1åˆ†é–“ï¼‹ä½™è£•ï¼‰
          **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Aï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ»è¦ªã—ã¿ã‚„ã™ã„é›°å›²æ°—ï¼‰

          **ã‚¿ã‚¹ã‚¯**:
          1. Google Lyriaã‚’ä½¿ã£ã¦èƒŒæ™¯éŸ³æ¥½ã‚’ç”Ÿæˆ
          2. éŸ³å£°ã«é©ã—ãŸãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒ»ãƒ†ãƒ³ãƒã§ç”Ÿæˆï¼ˆãƒªãƒ©ãƒƒã‚¯ã‚¹ãƒ»è¦ªã—ã¿ã‚„ã™ã„ï¼‰
          3. ç”Ÿæˆã—ãŸéŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Œ$MUSIC_DIR_A/background-music.wavã€ã«ä¿å­˜
          4. éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’å‡ºåŠ›

          kamuicode MCPã®éŸ³æ¥½ç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã€ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªãƒ©ã‚¸ã‚ªç•ªçµ„ã«é©ã—ãŸèƒŒæ™¯éŸ³æ¥½ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚"

          npx claude-code --prompt "$PROMPT"
          
          # éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
          if [ -f "$MUSIC_DIR_A/background-music.wav" ]; then
            echo "âœ… Music A generated successfully"
            echo "music-url=$MUSIC_DIR_A/background-music.wav" >> $GITHUB_OUTPUT
          else
            echo "âŒ Music A generation failed"
            exit 1
          fi
          
          echo "::endgroup::"

      # éŸ³æ¥½ç”ŸæˆBï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
      - name: éŸ³æ¥½ç”Ÿæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆB
        id: music-generation-b
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "::group::ğŸµ Music Generation Agent B Execution"
          
          FOLDER_NAME="${{ needs.setup-branch.outputs.folder-name }}"
          MUSIC_DIR_B="$FOLDER_NAME/music/version-b"
          
          # éŸ³æ¥½ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
          mkdir -p "$MUSIC_DIR_B"
          
          MUSIC_PROMPT_B="${{ needs.script-planning.outputs.music-prompt-b }}"
          
          PROMPT="kamuicode MCPã‚’ä½¿ç”¨ã—ã¦èƒŒæ™¯éŸ³æ¥½ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³Bï¼šãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

          **éŸ³æ¥½ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: $MUSIC_PROMPT_B
          **å‡ºåŠ›é•·ã•**: ç´„60-90ç§’ï¼ˆéŸ³å£°ã®1åˆ†é–“ï¼‹ä½™è£•ï¼‰
          **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Bï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ»æŠ€è¡“çš„ãªé›°å›²æ°—ï¼‰

          **ã‚¿ã‚¹ã‚¯**:
          1. Google Lyriaã‚’ä½¿ã£ã¦èƒŒæ™¯éŸ³æ¥½ã‚’ç”Ÿæˆ
          2. éŸ³å£°ã«é©ã—ãŸãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒ»ãƒ†ãƒ³ãƒã§ç”Ÿæˆï¼ˆé›†ä¸­ãƒ»ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰
          3. ç”Ÿæˆã—ãŸéŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€Œ$MUSIC_DIR_B/background-music.wavã€ã«ä¿å­˜
          4. éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’å‡ºåŠ›

          kamuicode MCPã®éŸ³æ¥½ç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ©ã‚¸ã‚ªç•ªçµ„ã«é©ã—ãŸèƒŒæ™¯éŸ³æ¥½ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚"

          npx claude-code --prompt "$PROMPT"
          
          # éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
          if [ -f "$MUSIC_DIR_B/background-music.wav" ]; then
            echo "âœ… Music B generated successfully"
            echo "music-url=$MUSIC_DIR_B/background-music.wav" >> $GITHUB_OUTPUT
          else
            echo "âŒ Music B generation failed"
            exit 1
          fi
          
          echo "::endgroup::"

  compose-final-audio-a:
    runs-on: ubuntu-latest
    needs: [setup-branch, script-planning, generate-audio-and-music]
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.setup-branch.outputs.branch-name }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Claude Code SDK
        run: npm install @anthropic-ai/claude-code
      
      - name: Install FFmpeg
        run: |
          sudo apt update
          sudo apt install -y ffmpeg
      
      - name: éŸ³å£°åˆæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆA
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "::group::ğŸšï¸ Audio Composition Agent A Execution"
          
          FOLDER_NAME="${{ needs.setup-branch.outputs.folder-name }}"
          FINAL_DIR_A="$FOLDER_NAME/final/version-a"
          
          # æœ€çµ‚å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
          mkdir -p "$FINAL_DIR_A"
          
          VOICE_FILE_A="${{ needs.generate-audio-and-music.outputs.voice-url-a }}"
          MUSIC_FILE_A="${{ needs.generate-audio-and-music.outputs.music-url-a }}"
          
          PROMPT="FFmpegã‚’ä½¿ç”¨ã—ã¦éŸ³å£°ã¨éŸ³æ¥½ã‚’åˆæˆã—ã€æœ€çµ‚çš„ãªãƒ©ã‚¸ã‚ªéŸ³å£°ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³Aï¼šã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼‰ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

          **éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«**: $VOICE_FILE_A
          **éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«**: $MUSIC_FILE_A
          **å‡ºåŠ›å…ˆ**: $FINAL_DIR_A/final-radio-audio.wav
          **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Aï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ»è¦ªã—ã¿ã‚„ã™ã„ï¼‰

          **åˆæˆè¦ä»¶**:
          1. èƒŒæ™¯éŸ³æ¥½ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’éŸ³å£°ã®60%ã«èª¿æ•´ï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªé›°å›²æ°—ã‚’é‡è¦–ï¼‰
          2. éŸ³å£°ã‚’ãƒ¡ã‚¤ãƒ³ã«ã€éŸ³æ¥½ã‚’èƒŒæ™¯ã¨ã—ã¦é…ç½®
          3. æŸ”ã‚‰ã‹ã„ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ãƒ»ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã‚’é©ç”¨
          4. éŸ³å£°ã®é•·ã•ã«åˆã‚ã›ã¦éŸ³æ¥½ã‚’ãƒ«ãƒ¼ãƒ—ã¾ãŸã¯ãƒˆãƒªãƒŸãƒ³ã‚°
          5. æœ€çµ‚çš„ãªéŸ³è³ªã¯é«˜å“è³ªã‚’ç¶­æŒ

          **FFmpegã‚³ãƒãƒ³ãƒ‰ä¾‹**:
          - éŸ³æ¥½ãƒœãƒªãƒ¥ãƒ¼ãƒ èª¿æ•´: -filter:a \"volume=0.6\"
          - éŸ³å£°ã¨éŸ³æ¥½ã®åˆæˆ: -filter_complex \"[1:a]volume=0.6[bg];[0:a][bg]amix=inputs=2[out]\"
          - ãƒ•ã‚§ãƒ¼ãƒ‰åŠ¹æœ: afade=in:st=0:d=2,afade=out:st=(duration-2):d=2

          éŸ³å£°ã¨éŸ³æ¥½ã‚’åˆæˆã—ã€ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã§è¦ªã—ã¿ã‚„ã™ã„é«˜å“è³ªãªãƒ©ã‚¸ã‚ªéŸ³å£°ã‚’å®Œæˆã•ã›ã¦ãã ã•ã„ã€‚"

          npx claude-code --prompt "$PROMPT"
          
          # æœ€çµ‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
          if [ -f "$FINAL_DIR_A/final-radio-audio.wav" ]; then
            echo "âœ… Final radio audio A created successfully"
            
            # ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’è¡¨ç¤º
            echo "ğŸ“Š File information:"
            ls -lh "$FINAL_DIR_A/final-radio-audio.wav"
            
            # éŸ³å£°æ™‚é–“ã‚’è¡¨ç¤º
            DURATION=$(ffprobe -v quiet -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 "$FINAL_DIR_A/final-radio-audio.wav" 2>/dev/null || echo "Unknown")
            echo "â±ï¸ Duration: ${DURATION}s"
          else
            echo "âŒ Final audio A composition failed"
            exit 1
          fi
          
          echo "::endgroup::"

  compose-final-audio-b:
    runs-on: ubuntu-latest
    needs: [setup-branch, script-planning, generate-audio-and-music]
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.setup-branch.outputs.branch-name }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Claude Code SDK
        run: npm install @anthropic-ai/claude-code
      
      - name: Install FFmpeg
        run: |
          sudo apt update
          sudo apt install -y ffmpeg
      
      - name: éŸ³å£°åˆæˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆB
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          echo "::group::ğŸšï¸ Audio Composition Agent B Execution"
          
          FOLDER_NAME="${{ needs.setup-branch.outputs.folder-name }}"
          FINAL_DIR_B="$FOLDER_NAME/final/version-b"
          
          # æœ€çµ‚å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
          mkdir -p "$FINAL_DIR_B"
          
          VOICE_FILE_B="${{ needs.generate-audio-and-music.outputs.voice-url-b }}"
          MUSIC_FILE_B="${{ needs.generate-audio-and-music.outputs.music-url-b }}"
          
          PROMPT="FFmpegã‚’ä½¿ç”¨ã—ã¦éŸ³å£°ã¨éŸ³æ¥½ã‚’åˆæˆã—ã€æœ€çµ‚çš„ãªãƒ©ã‚¸ã‚ªéŸ³å£°ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³Bï¼šãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

          **éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«**: $VOICE_FILE_B
          **éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«**: $MUSIC_FILE_B
          **å‡ºåŠ›å…ˆ**: $FINAL_DIR_B/final-radio-audio.wav
          **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Bï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ»æŠ€è¡“çš„ï¼‰

          **åˆæˆè¦ä»¶**:
          1. èƒŒæ™¯éŸ³æ¥½ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’éŸ³å£°ã®60%ã«èª¿æ•´ï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã§ã‚‚éŸ³æ¥½ã‚’æ¥½ã—ã‚€ï¼‰
          2. éŸ³å£°ã‚’ãƒ¡ã‚¤ãƒ³ã«ã€éŸ³æ¥½ã‚’èƒŒæ™¯ã¨ã—ã¦é…ç½®
          3. ç²¾å¯†ãªãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ãƒ»ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã‚’é©ç”¨
          4. éŸ³å£°ã®é•·ã•ã«åˆã‚ã›ã¦éŸ³æ¥½ã‚’ãƒ«ãƒ¼ãƒ—ã¾ãŸã¯ãƒˆãƒªãƒŸãƒ³ã‚°
          5. æœ€çµ‚çš„ãªéŸ³è³ªã¯é«˜å“è³ªã‚’ç¶­æŒ

          **FFmpegã‚³ãƒãƒ³ãƒ‰ä¾‹**:
          - éŸ³æ¥½ãƒœãƒªãƒ¥ãƒ¼ãƒ èª¿æ•´: -filter:a \"volume=0.6\"
          - éŸ³å£°ã¨éŸ³æ¥½ã®åˆæˆ: -filter_complex \"[1:a]volume=0.6[bg];[0:a][bg]amix=inputs=2[out]\"
          - ãƒ•ã‚§ãƒ¼ãƒ‰åŠ¹æœ: afade=in:st=0:d=1.5,afade=out:st=(duration-1.5):d=1.5

          éŸ³å£°ã¨éŸ³æ¥½ã‚’åˆæˆã—ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã§æŠ€è¡“çš„ãªé«˜å“è³ªãªãƒ©ã‚¸ã‚ªéŸ³å£°ã‚’å®Œæˆã•ã›ã¦ãã ã•ã„ã€‚"

          npx claude-code --prompt "$PROMPT"
          
          # æœ€çµ‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
          if [ -f "$FINAL_DIR_B/final-radio-audio.wav" ]; then
            echo "âœ… Final radio audio B created successfully"
            
            # ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’è¡¨ç¤º
            echo "ğŸ“Š File information:"
            ls -lh "$FINAL_DIR_B/final-radio-audio.wav"
            
            # éŸ³å£°æ™‚é–“ã‚’è¡¨ç¤º
            DURATION=$(ffprobe -v quiet -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 "$FINAL_DIR_B/final-radio-audio.wav" 2>/dev/null || echo "Unknown")
            echo "â±ï¸ Duration: ${DURATION}s"
          else
            echo "âŒ Final audio B composition failed"
            exit 1
          fi
          
          echo "::endgroup::"

  finalize-and-commit:
    runs-on: ubuntu-latest
    needs: [setup-branch, compose-final-audio-a, compose-final-audio-b]
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.setup-branch.outputs.branch-name }}

      - name: Commit and push results
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Add generated radio audio (A&B versions): ${{ inputs.script_content }}" || echo "No changes to commit"
          git push origin ${{ needs.setup-branch.outputs.branch-name }}

      - name: Create Pull Request
        env:
          GITHUB_TOKEN: ${{ secrets.PAT_TOKEN }}
        run: |
          gh pr create \
            --title "Add new AI-generated radio audio (2 versions): $(echo '${{ inputs.script_content }}' | head -c 50)..." \
            --body "## ç”Ÿæˆã•ã‚ŒãŸãƒ©ã‚¸ã‚ªéŸ³å£°ï¼ˆ2ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰

          **åŸç¨¿**: ${{ inputs.script_content }}
          **éŸ³æ¥½ã®é›°å›²æ°—**: ${{ inputs.music_mood }}

          ### ğŸ™ï¸ ç”Ÿæˆã•ã‚ŒãŸ2ã¤ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
          - **ãƒãƒ¼ã‚¸ãƒ§ãƒ³A**: ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ»è¦ªã—ã¿ã‚„ã™ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆéŸ³æ¥½ãƒœãƒªãƒ¥ãƒ¼ãƒ 60%ï¼‰
          - **ãƒãƒ¼ã‚¸ãƒ§ãƒ³B**: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ»æŠ€è¡“çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆéŸ³æ¥½ãƒœãƒªãƒ¥ãƒ¼ãƒ 60%ï¼‰

          ### ğŸ“ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 
          \`\`\`
          ${{ needs.setup-branch.outputs.folder-name }}/
          â”œâ”€â”€ planning/
          â”‚   â”œâ”€â”€ version-a/
          â”‚   â”‚   â”œâ”€â”€ radio-script.txt        # å°æœ¬Aï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼‰
          â”‚   â”‚   â”œâ”€â”€ voice-style.json        # éŸ³å£°ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šA
          â”‚   â”‚   â”œâ”€â”€ music-prompt.txt        # éŸ³æ¥½ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆA
          â”‚   â”‚   â””â”€â”€ radio-strategy.md       # åˆ¶ä½œæˆ¦ç•¥A
          â”‚   â””â”€â”€ version-b/
          â”‚       â”œâ”€â”€ radio-script.txt        # å°æœ¬Bï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰
          â”‚       â”œâ”€â”€ voice-style.json        # éŸ³å£°ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šB
          â”‚       â”œâ”€â”€ music-prompt.txt        # éŸ³æ¥½ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆB
          â”‚       â””â”€â”€ radio-strategy.md       # åˆ¶ä½œæˆ¦ç•¥B
          â”œâ”€â”€ audio/
          â”‚   â”œâ”€â”€ version-a/
          â”‚   â”‚   â””â”€â”€ radio-voice.wav         # éŸ³å£°Aï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼‰
          â”‚   â””â”€â”€ version-b/
          â”‚       â””â”€â”€ radio-voice.wav         # éŸ³å£°Bï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰
          â”œâ”€â”€ music/
          â”‚   â”œâ”€â”€ version-a/
          â”‚   â”‚   â””â”€â”€ background-music.wav    # éŸ³æ¥½Aï¼ˆè¦ªã—ã¿ã‚„ã™ã„ï¼‰
          â”‚   â””â”€â”€ version-b/
          â”‚       â””â”€â”€ background-music.wav    # éŸ³æ¥½Bï¼ˆæŠ€è¡“çš„ï¼‰
          â””â”€â”€ final/
              â”œâ”€â”€ version-a/
              â”‚   â””â”€â”€ final-radio-audio.wav   # æœ€çµ‚åˆæˆéŸ³å£°A
              â””â”€â”€ version-b/
                  â””â”€â”€ final-radio-audio.wav   # æœ€çµ‚åˆæˆéŸ³å£°B
          \`\`\`

          ### ğŸ”§ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç‰¹å¾´
          
          #### ãƒãƒ¼ã‚¸ãƒ§ãƒ³Aï¼ˆã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ï¼‰
          - è©±ã—æ–¹: ã€Œãˆã£ã¨ã€ã€Œã¡ã‚‡ã£ã¨ã€å¤šç”¨ã€è¦ªã—ã¿ã‚„ã™ã„å£èª¿
          - éŸ³å£°è¨­å®š: è©±é€Ÿ1.0ã€æ„Ÿæƒ…å¼·åº¦0.5
          - éŸ³æ¥½: ãƒªãƒ©ãƒƒã‚¯ã‚¹ãƒ»è¦ªã—ã¿ã‚„ã™ã„é›°å›²æ°—
          - åˆæˆ: èƒŒæ™¯éŸ³æ¥½60%ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€æŸ”ã‚‰ã‹ã„ãƒ•ã‚§ãƒ¼ãƒ‰
          
          #### ãƒãƒ¼ã‚¸ãƒ§ãƒ³Bï¼ˆãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ï¼‰
          - è©±ã—æ–¹: æŠ€è¡“çš„è¡¨ç¾é‡è¦–ã€èª¬æ˜çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
          - éŸ³å£°è¨­å®š: è©±é€Ÿ1.2ã€æ„Ÿæƒ…å¼·åº¦0.3
          - éŸ³æ¥½: é›†ä¸­ãƒ»ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªé›°å›²æ°—
          - åˆæˆ: èƒŒæ™¯éŸ³æ¥½60%ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€ç²¾å¯†ãªãƒ•ã‚§ãƒ¼ãƒ‰

          ğŸ¤– Generated with [Claude Code](https://claude.ai/code) & [kamuicode MCP](https://www.kamui.ai/ja)

          Co-Authored-By: Claude <noreply@anthropic.com>" \
            --head ${{ needs.setup-branch.outputs.branch-name }} \
            --base main