name: BGM Generation Opening (Minimal)
on:
  workflow_call:
    outputs:
      bgm-url:
        value: ${{ jobs.generate.outputs.url }}
      bgm-file:
        value: ${{ jobs.generate.outputs.file }}

jobs:
  generate:
    runs-on: ubuntu-latest
    outputs:
      url: ${{ steps.bgm.outputs.music-url }}
      file: ${{ steps.bgm.outputs.music-file }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Claude Code SDK
        run: |
          echo "ğŸ“¦ Claude Code SDKã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
          npm install @anthropic-ai/claude-code --force 2>/dev/null || echo "âš ï¸ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã—ã¦ç¶šè¡Œ"
      
      - name: Generate Opening BGM with Google Lyria
        id: bgm
        env:
          CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
        run: |
          echo "::group::ğŸµ Opening BGM Generation with Google Lyria"
          echo "Starting at: $(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
          
          # MCPè¨­å®šã®ç¢ºèª
          MCP_CONFIG_PATH=".claude/mcp-kamuicode.json"
          MCP_CONFIG_ABS_PATH="$(pwd)/$MCP_CONFIG_PATH"
          
          # BGMç”Ÿæˆãƒªãƒˆãƒ©ã‚¤ãƒ«ãƒ¼ãƒ—ï¼ˆæœ€å¤§3å›ï¼‰
          SUCCESS=false
          for RETRY_COUNT in {1..3}; do
            echo "ğŸ”„ BGMç”Ÿæˆè©¦è¡Œ $RETRY_COUNT/3"
          
          # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ§‹ç¯‰
          PROMPT="ä»¥ä¸‹ã®ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°BGMã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š

          ã€BGMè¦ä»¶ã€‘
          - é•·ã•: 30ç§’ï¼ˆãƒ«ãƒ¼ãƒ—ç”¨ãƒ™ãƒ¼ã‚¹éŸ³æ¥½ï¼‰
          - ã‚¹ã‚¿ã‚¤ãƒ«: é«˜é€Ÿãƒ†ãƒ³ãƒã®ãƒ©ã‚¸ã‚ªã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ã€BPM180-200ã®ç–¾èµ°æ„Ÿã‚ã‚‹ãƒ†ã‚¯ãƒãƒãƒƒãƒ—
          - é›°å›²æ°—: æœã®ãƒ©ã‚¸ã‚ªã®èºå‹•æ„Ÿã€ç•ªçµ„é–‹å§‹ã®é«˜æšæ„Ÿã€è´å–è€…ã®æ³¨æ„ã‚’ä¸€ç¬ã§å¼•ãã¤ã‘ã‚‹
          - æ¥½å™¨: ãƒ‘ãƒ³ãƒã®ã‚ã‚‹ã‚·ãƒ³ã‚»ãƒ™ãƒ¼ã‚¹ã€ã‚¢ã‚¿ãƒƒã‚¯å¼·ã‚ã®ã‚­ãƒƒã‚¯ã€ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿã®ã‚ã‚‹ãƒã‚¤ãƒãƒƒãƒˆã€FMéŸ³æºç³»ã‚·ãƒ³ã‚»ãƒªãƒ¼ãƒ‰
          - ç‰¹å¾´: å³åº§ã«ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãŒä¸ŠãŒã‚‹å°å…¥éƒ¨ã€ãƒ©ã‚¸ã‚ªã‚¸ãƒ³ã‚°ãƒ«ã®ã‚ˆã†ãªçŸ­ã„ãƒ•ãƒ¬ãƒ¼ã‚ºã€æ€¥é€Ÿãªãƒ“ãƒ«ãƒ‰ã‚¢ãƒƒãƒ—

          **é‡è¦**: 
          1. \`mcp__t2m-google-lyria__lyria_generate\` ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
          2. ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„
          3. auto_download: true, auto_open: false ã‚’è¨­å®šã—ã¦ãã ã•ã„

          **å¿…é ˆ**: å¿…ãšæ­£ã—ã„ãƒ„ãƒ¼ãƒ«å \`mcp__t2m-google-lyria__lyria_generate\` ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚"
          
          echo "ğŸš€ Starting Opening BGM Generation..."
          echo "ğŸ“ Prompt length: ${#PROMPT}"
          
          echo "ğŸ“‹ MCP Configuration Check:"
          echo "Working directory: $(pwd)"
          echo "MCP config path: $MCP_CONFIG_PATH"
          echo "MCP config absolute path: $MCP_CONFIG_ABS_PATH"
          
          # MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
          if [ -f "$MCP_CONFIG_ABS_PATH" ]; then
            echo "âœ… MCP config file exists"
          else
            echo "::warning::âš ï¸ MCP config file not found, proceeding without kamuicode"
          fi
          
          # Claude Code CLIã®å®Ÿè¡Œ
          echo "ğŸ¤– Claude Code CLIå®Ÿè¡Œé–‹å§‹"
          if [ -f "$MCP_CONFIG_ABS_PATH" ]; then
            echo "âœ… MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ"
            
            # Claude Codeã®å®Ÿè¡Œã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            echo "ğŸ¯ Claude Code CLIå®Ÿè¡Œä¸­ï¼ˆ120ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰..."
            BGM_RESULT=$(timeout 120 npx @anthropic-ai/claude-code \
              --mcp-config="$MCP_CONFIG_ABS_PATH" \
              --allowedTools "mcp__t2m-google-lyria__lyria_generate,Bash" \
              --max-turns 5 \
              --print \
              --verbose \
              "$PROMPT" 2>&1) || {
                CLAUDE_EXIT_CODE=$?
                echo "::error::âŒ Claude Codeå®Ÿè¡Œå¤±æ•— (exit code: $CLAUDE_EXIT_CODE)"
                if [ $CLAUDE_EXIT_CODE -eq 124 ]; then
                  echo "::error::âŒ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ (2åˆ†)"
                fi
                echo "::error::è©³ç´°ãªã‚¨ãƒ©ãƒ¼å‡ºåŠ›:"
                echo "$BGM_RESULT" | head -50
                echo "::error::ç’°å¢ƒå¤‰æ•°ç¢ºèª:"
                echo "CLAUDE_CODE_OAUTH_TOKEN: ${CLAUDE_CODE_OAUTH_TOKEN:0:20}..."
                BGM_RESULT=""
              }
          else
            echo "::warning::âš ï¸ MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $MCP_CONFIG_ABS_PATH"
            echo "::warning::ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…å®¹:"
            ls -la || true
            BGM_RESULT=""
          fi
          
          echo "ğŸµ BGMç”Ÿæˆçµæœ (æœ€åˆã®500æ–‡å­—):"
          echo "$BGM_RESULT" | head -c 500
          echo ""
          
          # çµæœã‹ã‚‰URLã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŠ½å‡º
          MUSIC_URL=$(echo "$BGM_RESULT" | grep -oP '(https://|gs://)[^\s]+\.(wav|mp3|m4a)' | head -1)
          # Claude Codeã®å‡ºåŠ›ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŠ½å‡ºï¼ˆãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã¾ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ¤œç´¢ï¼‰
          CLAUDE_FILE=$(echo "$BGM_RESULT" | grep -oP '`lyria_output_[^`]+\.wav`' | sed 's/`//g' | head -1)
          if [ ! -z "$CLAUDE_FILE" ]; then
            echo "âœ… Claude Codeã®å‡ºåŠ›ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ¤œå‡º: $CLAUDE_FILE"
          fi
          MUSIC_FILE="bgm-opening.wav"
          
          # ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ï¼ˆã‚ˆã‚ŠåŒ…æ‹¬çš„ã«ï¼‰
          echo "ğŸ” ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ä¸­..."
          ls -la || true
          
          # è¤‡æ•°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢
          DOWNLOADED_FILE=""
          
          # ãƒ‘ã‚¿ãƒ¼ãƒ³0: Claude CodeãŒæ˜ç¤ºçš„ã«å‡ºåŠ›ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å
          if [ ! -z "$CLAUDE_FILE" ] && [ -f "$CLAUDE_FILE" ]; then
            DOWNLOADED_FILE="$CLAUDE_FILE"
            echo "âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³0ï¼ˆClaudeå‡ºåŠ›ï¼‰ã§ç™ºè¦‹: $DOWNLOADED_FILE"
          fi
          
          # ãƒ‘ã‚¿ãƒ¼ãƒ³1: lyria_output_ã§å§‹ã¾ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
          if [ -z "$DOWNLOADED_FILE" ]; then
            DOWNLOADED_FILE=$(find . -name "lyria_output_*.wav" -type f 2>/dev/null | head -1)
            [ ! -z "$DOWNLOADED_FILE" ] && echo "âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³1ã§ç™ºè¦‹: $DOWNLOADED_FILE"
          fi
          
          # ãƒ‘ã‚¿ãƒ¼ãƒ³2: musicã§å§‹ã¾ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
          if [ -z "$DOWNLOADED_FILE" ]; then
            DOWNLOADED_FILE=$(find . -name "music*.wav" -type f 2>/dev/null | head -1)
            [ ! -z "$DOWNLOADED_FILE" ] && echo "âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³2ã§ç™ºè¦‹: $DOWNLOADED_FILE"
          fi
          
          # ãƒ‘ã‚¿ãƒ¼ãƒ³3: æœ€è¿‘ä½œæˆã•ã‚ŒãŸwavãƒ•ã‚¡ã‚¤ãƒ«
          if [ -z "$DOWNLOADED_FILE" ]; then
            DOWNLOADED_FILE=$(find . -name "*.wav" -type f -mmin -5 2>/dev/null | head -1)
            [ ! -z "$DOWNLOADED_FILE" ] && echo "âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³3ã§ç™ºè¦‹: $DOWNLOADED_FILE"
          fi
          
          # ãƒ‘ã‚¿ãƒ¼ãƒ³4: ä»»æ„ã®wavãƒ•ã‚¡ã‚¤ãƒ«
          if [ -z "$DOWNLOADED_FILE" ]; then
            DOWNLOADED_FILE=$(find . -name "*.wav" -type f 2>/dev/null | head -1)
            [ ! -z "$DOWNLOADED_FILE" ] && echo "âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³4ã§ç™ºè¦‹: $DOWNLOADED_FILE"
          fi
          
          echo "ğŸ” URLæŠ½å‡ºçµæœ: '$MUSIC_URL'"
          echo "ğŸ“ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«: '$DOWNLOADED_FILE'"
          
          # ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å„ªå…ˆï¼‰
          if [ ! -z "$DOWNLOADED_FILE" ] && [ -s "$DOWNLOADED_FILE" ]; then
            echo "âœ… æ—¢ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨: $DOWNLOADED_FILE"
            
            FILE_SIZE=$(stat -c%s "$DOWNLOADED_FILE")
            echo "ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: ${FILE_SIZE} bytes"
            
            # éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç°¡æ˜“æ¤œè¨¼
            file "$DOWNLOADED_FILE"
            
            # XMLãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã†
            if file "$DOWNLOADED_FILE" | grep -q "XML"; then
              echo "::error::âŒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒXMLã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ã™"
              echo "::error::ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã®å†…å®¹:"
              cat "$DOWNLOADED_FILE"
              continue  # ãƒªãƒˆãƒ©ã‚¤ãƒ«ãƒ¼ãƒ—ã«æˆ»ã‚‹
            fi
            
            # ffmpegã§ãƒ«ãƒ¼ãƒ—æ‹¡å¼µ
            sudo apt-get update && sudo apt-get install -y ffmpeg
            if ffmpeg -stream_loop -1 -i "$DOWNLOADED_FILE" -t 30 -ar 44100 -ac 2 -c:a pcm_s16le "bgm-opening-30s.wav" -y; then
              echo "âœ… BGMãƒ«ãƒ¼ãƒ—æ‹¡å¼µæˆåŠŸ"
              echo "music-url=file://$(pwd)/$DOWNLOADED_FILE" >> $GITHUB_OUTPUT
              echo "music-file=bgm-opening-30s.wav" >> $GITHUB_OUTPUT
            else
              echo "::error::âŒ ffmpegå‡¦ç†å¤±æ•—"
              exit 1
            fi
          elif [ ! -z "$MUSIC_URL" ] && [[ "$MUSIC_URL" =~ ^https:// ]]; then
            echo "âœ… HTTPS URLã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰: $MUSIC_URL"
            
            # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
            if curl -L "$MUSIC_URL" -o "$MUSIC_FILE" --max-time 60; then
              if [ -s "$MUSIC_FILE" ]; then
                FILE_SIZE=$(stat -c%s "$MUSIC_FILE")
                echo "âœ… BGMãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æˆåŠŸ (${FILE_SIZE} bytes)"
                
                # éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç°¡æ˜“æ¤œè¨¼
                file "$MUSIC_FILE"
                
                # ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆXMLã‚¨ãƒ©ãƒ¼ã‹ã©ã†ã‹ï¼‰
                echo "ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ï¼ˆæœ€åˆã®200æ–‡å­—ï¼‰:"
                head -c 200 "$MUSIC_FILE" || true
                echo ""
                
                # XMLãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã†
                if file "$MUSIC_FILE" | grep -q "XML"; then
                  echo "::error::âŒ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒXMLã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ã™"
                  echo "::error::ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã®å†…å®¹:"
                  cat "$MUSIC_FILE"
                  exit 1
                fi
                
                # ffmpegã§ãƒ«ãƒ¼ãƒ—æ‹¡å¼µ
                sudo apt-get update && sudo apt-get install -y ffmpeg
                if ffmpeg -stream_loop -1 -i "$MUSIC_FILE" -t 30 -ar 44100 -ac 2 -c:a pcm_s16le "bgm-opening-30s.wav" -y; then
                  echo "âœ… BGMãƒ«ãƒ¼ãƒ—æ‹¡å¼µæˆåŠŸ"
                  echo "music-url=$MUSIC_URL" >> $GITHUB_OUTPUT
                  echo "music-file=bgm-opening-30s.wav" >> $GITHUB_OUTPUT
                else
                  echo "::error::âŒ ffmpegå‡¦ç†å¤±æ•—"
                  exit 1
                fi
              else
                echo "::warning::âš ï¸ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã§ã™"
              fi
            else
              echo "::warning::âš ï¸ BGMãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ"
            fi
          else
            echo "::warning::âš ï¸ æœ‰åŠ¹ãªURLã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
          fi
          
            # BGMç”ŸæˆæˆåŠŸãƒã‚§ãƒƒã‚¯
            if [ -f "bgm-opening-30s.wav" ] && [ -s "bgm-opening-30s.wav" ]; then
              echo "âœ… BGMç”ŸæˆæˆåŠŸï¼ˆè©¦è¡Œ $RETRY_COUNT/3ï¼‰"
              SUCCESS=true
              break
            else
              echo "::warning::âš ï¸ BGMç”Ÿæˆå¤±æ•—ï¼ˆè©¦è¡Œ $RETRY_COUNT/3ï¼‰"
              echo "::warning::è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°:"
              echo "::warning::Claude Codeå®Ÿè¡Œçµæœ: $BGM_RESULT"
              echo "::warning::æŠ½å‡ºã•ã‚ŒãŸURL: '$MUSIC_URL'"
              echo "::warning::ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«: '$DOWNLOADED_FILE'"
              
              # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
              rm -f bgm-opening-30s.wav lyria_output_*.wav *.wav 2>/dev/null || true
              
              if [ $RETRY_COUNT -lt 3 ]; then
                echo "ğŸ”„ 30ç§’å¾Œã«å†è©¦è¡Œã—ã¾ã™..."
                sleep 30
              fi
            fi
          done
          
          # æœ€çµ‚çµæœãƒã‚§ãƒƒã‚¯
          if [ "$SUCCESS" != "true" ]; then
            echo "::error::âŒ BGMç”Ÿæˆã«3å›å¤±æ•—ã—ã¾ã—ãŸ"
            echo "::error::ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…å®¹:"
            ls -la || true
            echo "::error::MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª:"
            if [ -f "$MCP_CONFIG_ABS_PATH" ]; then
              echo "::error::MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã™: $MCP_CONFIG_ABS_PATH"
              head -20 "$MCP_CONFIG_ABS_PATH" || true
            else
              echo "::error::MCPè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $MCP_CONFIG_ABS_PATH"
            fi
            exit 1
          fi
          
          # æœ€çµ‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
          if [ -f "bgm-opening-30s.wav" ] && [ -s "bgm-opening-30s.wav" ]; then
            FINAL_SIZE=$(stat -c%s "bgm-opening-30s.wav")
            echo "âœ… æœ€çµ‚BGMãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆå®Œäº† (${FINAL_SIZE} bytes)"
          else
            echo "::error::âŒ æœ€çµ‚BGMãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ"
            exit 1
          fi
          
          echo "::endgroup::"
      
      - name: Upload BGM artifact
        uses: actions/upload-artifact@v4
        with:
          name: bgm-opening
          path: bgm-opening-30s.wav
          retention-days: 1